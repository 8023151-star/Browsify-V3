<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Embedder — in-page only</title>
  <style>
    :root{
      --bg:#071827; --card:#0b1220; --muted:#98a0b3; --accent:#ff4250;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#051022,#071827);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:24px;}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);}
    .controls{display:flex;gap:10px;align-items:center;}
    .input-wrap{flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;display:flex;align-items:center;}
    input[type="text"]{flex:1;background:transparent;border:0;outline:0;color:var(--muted);font-size:15px;padding:6px;}
    button{background:linear-gradient(180deg,#ff6b72,var(--accent));color:#fff;border:0;padding:9px 14px;border-radius:8px;font-weight:600;cursor:pointer;}
    .video-container{margin-top:16px;border-radius:10px;overflow:hidden;background:#000;border:1px solid rgba(255,255,255,0.02);}
    .video-inner{position:relative;width:100%;padding-top:56.25%;}
    #player{position:absolute;inset:0;}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.45),rgba(0,0,0,0.55));color:#ffd6d6;padding:12px;text-align:center;font-size:15px;}
    .hidden{display:none}
    .status{margin-left:12px;font-size:13px;color:#ffb3b8}
    @media (max-width:560px){ .controls{flex-direction:column;align-items:stretch} button{width:100%} }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h2 style="margin:0 0 10px 0;font-size:18px">YouTube Embedder (in-page only)</h2>
    <form id="form">
      <div class="controls">
        <div class="input-wrap">
          <input id="url" type="text" placeholder="Paste YouTube URL or video ID (e.g. https://www.youtube.com/watch?v=0e3GPea1Tyg)" aria-label="YouTube URL">
        </div>
        <button id="embedBtn" type="submit">Embed</button>
        <div id="status" class="status" aria-live="polite" hidden></div>
      </div>
    </form>

    <div id="videoBox" class="video-container hidden" aria-live="polite">
      <div class="video-inner">
        <div id="player"></div>
        <div id="errorOverlay" class="overlay hidden" role="alert"></div>
      </div>
    </div>
  </div>

  <script>
    // Helper: extract YouTube video ID from many URL formats or raw ID
    function extractYouTubeID(url) {
      if (!url) return null;
      url = url.trim();
      if (/^[A-Za-z0-9_-]{11}$/.test(url)) return url;
      try {
        const parsed = new URL(url.includes('://') ? url : 'https://' + url);
        const v = parsed.searchParams.get('v');
        if (v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
        // common path positions
        const path = parsed.pathname || '';
        let m = path.match(/(?:\/embed\/|\/v\/|\/shorts\/|\/watch\/|\/)([A-Za-z0-9_-]{11})(?:$|\/|\?)/);
        if (m && m[1]) return m[1];
        if (parsed.hostname && parsed.hostname.toLowerCase().includes('youtu.be')) {
          const maybe = parsed.pathname.replace(/^\/+/, '');
          if (/^[A-Za-z0-9_-]{11}$/.test(maybe)) return maybe;
        }
      } catch(e) {
        // fallback regex
      }
      const gm = url.match(/(?:v=|v\/|embed\/|youtu\.be\/|\/shorts\/)([A-Za-z0-9_-]{11})/);
      return gm && gm[1] ? gm[1] : null;
    }

    const form = document.getElementById('form');
    const urlInput = document.getElementById('url');
    const embedBtn = document.getElementById('embedBtn');
    const status = document.getElementById('status');
    const videoBox = document.getElementById('videoBox');
    const playerContainer = document.getElementById('player');
    const errorOverlay = document.getElementById('errorOverlay');

    let ytReady = false;
    let ytPlayer = null;
    let playerCreateTimeout = null;

    // Load YouTube IFrame API
    (function loadYT(){
      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api";
      s.async = true;
      s.onload = ()=>{ /* script injected */ };
      document.head.appendChild(s);
      // global callback required by YT API
      window.onYouTubeIframeAPIReady = function() { ytReady = true; };
    })();

    function showStatus(msg, isError=false){
      status.hidden = false;
      status.textContent = msg;
      status.style.color = isError ? '#ffb3b8' : '#9be7a2';
    }
    function clearStatus(){ status.hidden = true; status.textContent = ''; }

    function showErrorOverlay(text){
      errorOverlay.textContent = text;
      errorOverlay.classList.remove('hidden');
    }
    function hideErrorOverlay(){
      errorOverlay.classList.add('hidden');
      errorOverlay.textContent = '';
    }

    function destroyPlayer(){
      if (ytPlayer && typeof ytPlayer.destroy === 'function') {
        try { ytPlayer.destroy(); } catch(e){ /* ignore */ }
      }
      ytPlayer = null;
      playerContainer.innerHTML = '';
      hideErrorOverlay();
      clearTimeout(playerCreateTimeout);
      playerCreateTimeout = null;
    }

    // Create or replace player given a videoId
    function createPlayer(videoId) {
      destroyPlayer();
      // Show container
      videoBox.classList.remove('hidden');
      showStatus('Loading player...', false);
      // Wait for YT API to be ready (up to a timeout)
      const start = Date.now();
      const waitForApi = () => {
        if (ytReady) {
          // Create player
          // Use youtube-nocookie domain for privacy; player still respects embed restrictions.
          ytPlayer = new YT.Player('player', {
            videoId: videoId,
            playerVars: {
              rel: 0,
              modestbranding: 1,
              playsinline: 1
            },
            events: {
              onReady: function(e){
                clearStatus();
                hideErrorOverlay();
                // We do NOT auto-play; user can press play in the embedded player.
              },
              onError: function(e){
                // YT error codes: 2, 5, 100, 101/150 (embedding disabled)
                const code = e.data;
                let msg = 'Unknown playback error (code ' + code + ').';
                if (code === 2) msg = 'Invalid request to player (bad parameter).';
                else if (code === 5) msg = 'HTML5 player error.';
                else if (code === 100) msg = 'Video not found or removed.';
                else if (code === 101 || code === 150) msg = 'Embedding is blocked by the video owner — this video cannot play inside other pages.';
                else msg = 'Playback error (code ' + code + ').';
                showErrorOverlay(msg);
                showStatus('Embed error: ' + msg, true);
              }
            }
          });
          // safety timeout in case the player fails to become ready and no onError fires
          playerCreateTimeout = setTimeout(() => {
            // If player exists but still not providing UI, check if iframe exists
            const iframe = playerContainer.querySelector('iframe');
            if (!iframe) {
              showErrorOverlay('Player could not be created. The environment may block iframes or external scripts.');
              showStatus('Embedding appears blocked by your viewer/environment.', true);
            }
          }, 3500);
        } else if (Date.now() - start < 7000) {
          // wait a bit more
          setTimeout(waitForApi, 150);
        } else {
          // API never became ready
          showErrorOverlay('YouTube API failed to load — embedding not available in this environment.');
          showStatus('YouTube API load failed; embedding not available.', true);
        }
      };
      waitForApi();
    }

    form.addEventListener('submit', function(e){
      e.preventDefault();
      clearStatus();
      hideErrorOverlay();
      const val = urlInput.value.trim();
      if (!val) { showStatus('Paste a YouTube URL or video ID.', true); return; }
      embedBtn.disabled = true;
      embedBtn.textContent = 'Embedding...';
      const id = extractYouTubeID(val);
      if (!id) {
        showStatus('Could not detect a YouTube video ID. Check the link.', true);
        embedBtn.disabled = false;
        embedBtn.textContent = 'Embed';
        return;
      }
      // Attempt to create player
      createPlayer(id);

      // Re-enable UI
      setTimeout(()=>{ embedBtn.disabled = false; embedBtn.textContent = 'Embed'; }, 600);
    });

    // If user clears input, destroy player
    urlInput.addEventListener('input', function(){
      if (!urlInput.value.trim()) {
        destroyPlayer();
        videoBox.classList.add('hidden');
        clearStatus();
      }
    });

    // On page unload, clean up
    window.addEventListener('beforeunload', destroyPlayer);
  </script>
</body>
</html>
